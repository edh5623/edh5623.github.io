<!DOCTYPE html>
<html lang="en">
    <body onload='initDotPlot()'>
        <div class="main">
            <b>Spotify has a metric associated with each song on their platoform called Valence which indicates how happy or sad a song is.</b>
            <br>
            <b>A Valence closer to 0 indicates a song is sad, while a valence closer to 1.0 indicates a song is happy.</b>
            <br>
            <b>Let's start by examining songs from a single genre of music that's been around for a while, classical.</b>
        </div>
        <svg></svg>
        <button id="next_button" type="submit" class="Button">Next</button>
        <!-- TODO: ANNOTATIONS THAT POINT TO TOP AND BOTTOM -->
    </body>

    <script src='https://d3js.org/d3.v5.min.js'></script>

    <script>

        async function initDotPlot() {
            var sp_data = await d3.csv('spotify_data.csv')

            // Filter to only classical
            sp_data = sp_data.filter( function (d) {
                if (d.track_genre == "classical") { return d; }
            });

            var width = 200;
            var height = 700;
            var marginTop = 80;
            var marginLeft = 150;
            var y = d3.scaleLinear().domain([0.0, 1.0]).range([height, 0])

            // Dots
            d3.select('svg')
                .attr("width", width + 2 * marginLeft)
                .attr("height", height + 2 * marginTop)
                .append("g")
                .attr("transform", "translate(" + marginLeft + "," + marginTop + ")")
                .selectAll('circle')
                .data(sp_data)
                .enter()
                .append('circle')
                .attr("cx", 50)
                .attr("cy", function (d, i) {
                    return y(d.valence);
                })
                .attr("r", 4)
                .attr("stroke", "deepskyblue")
                .attr("stroke-width", 0.8)
                .attr("fill", "none");

            // Y-axis line
            d3.select('svg')
                .append("g")
                .attr("transform", "translate("+marginLeft+","+marginTop+")")
                .call(d3.axisLeft(y).tickValues([0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0])); // .tickFormat(d3.format("~s"))

            // Y-axis text
            d3.select('svg')
                .append("text")
                .attr("class", "ylabel")
                .attr("text-anchor", "end")
                .attr("y", marginLeft-75)
                .attr("x", -height/2)
                .attr("dy", ".75em")
                .attr("transform", "rotate(-90)")
                .text("Valence");
        }
        // TODO: animate
    </script>

    <style>

        .main {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 16px;
        }

        .ylabel {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 22px;
        }

        .Button {
            padding: 6px;
            margin: 22px;
            background: #ddd;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .Button:hover {
            background: #ccc;
        }
    </style>
</html>